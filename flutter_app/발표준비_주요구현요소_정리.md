# ê±´ì–‘ëŒ€í•™êµë³‘ì› í™˜ì ì•± ê¸°ìˆ  ê°œìš”

ì¡°ì›ë“¤ì—ê²Œ ìˆ˜ì—…ìš©ìœ¼ë¡œ ì„¤ëª…í•  ìˆ˜ ìˆë„ë¡ **ì „ì²´ ì•„í‚¤í…ì²˜ì™€ ì£¼ìš” êµ¬í˜„ ìš”ì†Œ**ë¥¼ í•œ ë¬¸ì„œì— ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

---

## 1. ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flutter App  â”‚<â”€â”€â”€â”€â”€>â”‚ Django REST Backend  â”‚<â”€â”€â”€> MySQL
â”‚ (iOS/Android)â”‚       â”‚  (patients app)      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                        â”‚
     â”‚                        â”œâ”€ React Web (ë³‘ì› í™ˆí˜ì´ì§€ & ë‹¤ìš´ë¡œë“œ)
     â”‚                        â””â”€ Flask Model Server (AI/ë¶„ì„, ì¶”í›„ ì—°ë™)
     â”‚
     â””â”€ GitHub Actions CI/CD â”€â”€> GitHub Releases (APK/IPA ë°°í¬)
```

- **ë°ì´í„° íë¦„**: Flutter/React â†’ Django API â†’ MySQL
- **ì„¸ì…˜ ê´€ë¦¬**: Django JWT + Flutter `AppState` ì‹±ê¸€í„´
- **ì§€ë„/ìœ„ì¹˜**: Kakao Map Platform API + geolocator
- **ë°°í¬**: Git push â†’ GitHub Actions â†’ Release â†’ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼/AltStore

---

## 2. ê¸°ìˆ  ìŠ¤íƒ

| ë ˆì´ì–´ | ê¸°ìˆ  | ì—­í•  |
| --- | --- | --- |
| ëª¨ë°”ì¼ | Flutter 3.27, Dart >=3.0 | í™˜ì ì•± UI, iOS/Android ë™ì‹œ ê°œë°œ |
| ìƒíƒœ/ë°ì´í„° | ChangeNotifier AppState, Repository íŒ¨í„´ | ë¡œê·¸ì¸ ì„¸ì…˜, ì˜ˆì•½/ì§„ë£Œ ë°ì´í„° ë¡œë”© |
| ë°±ì—”ë“œ | Django REST Framework, MySQL | í™˜ì, ì˜ˆì•½, ê³ ê°ì„¼í„° API |
| ì§€ë„/ìœ„ì¹˜ | `kakao_map_plugin`, `geolocator`, `url_launcher` | ì•½êµ­/ë³‘ì› ì§€ë„, ê²½ë¡œ ì•ˆë‚´ |
| CI/CD | GitHub Actions, GitHub Releases | ë¹Œë“œ ìë™í™”, APK/IPA ë°°í¬ |
| iOS ì‚¬ì´ë“œë¡œë“œ | AltStore, AltServer, Developer Mode | IPA ì„¤ì¹˜/ì—…ë°ì´íŠ¸ |

---

## 3. Flutter ì£¼ìš” ëª¨ë“ˆ

| íŒŒì¼/ëª¨ë“ˆ | ì„¤ëª… |
| --- | --- |
| `lib/app_state.dart` | ì„¸ì…˜/í™˜ì ì •ë³´ ì‹±ê¸€í„´. ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì´ë²¤íŠ¸ ë¸Œë¡œë“œìºìŠ¤íŠ¸ |
| `lib/config/api_config.dart` | ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ ì„¤ì • (GCP ê¸°ë³¸, ë¡œì»¬ í† ê¸€) |
| `lib/services/*.dart` | ApiClient, PatientRepository, AppointmentRepository ë“± API í˜¸ì¶œ ë˜í¼ |
| `lib/screens/main_shell.dart` | í•˜ë‹¨ ë„¤ë¹„, íƒ­ êµ¬ì¡°, ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ `ë¡œê·¸ì¸/MY` ë ˆì´ë¸” ë³€ê²½ |
| `lib/screens/login_screen.dart` | ë¡œê·¸ì¸ + í™˜ì ì§„ë£Œ/ì˜ˆì•½ ìš”ì•½ (ë‹¤ê°€ì˜¤ëŠ” ì¼ì •) |
| `lib/screens/reservation_screen.dart` | ì˜ˆì•½ UI, ë¡œê·¸ì¸ ê°€ë“œ, í™˜ì ì •ë³´ í¬í•¨ ì˜ˆì•½ ìš”ì²­ |
| `lib/screens/alerts_screen.dart` | ê±´ê°• ì•Œë¦¼ ì¹´ë“œ, ë¡œê·¸ì¸ ì—¬ë¶€ë³„ ë ˆì´ì•„ì›ƒ |
| `lib/screens/customer_center_screen.dart` | ê³ ê°ì„¼í„° í—ˆë¸Œ: ê³ ê°ì˜ ì†Œë¦¬, ì±—ë´‡, ì „í™”ë²ˆí˜¸, FAQ |
| `lib/screens/voice_of_customer_screen.dart` | ì˜¨ë¼ì¸ ì ‘ìˆ˜ í¼, ì…ë ¥ ê²€ì¦, íŒŒì¼ ì„ íƒ UI |
| `lib/screens/important_phones_screen.dart` | ê·¸ë¦¬ë“œí˜• ì£¼ìš” ì „í™”ë²ˆí˜¸ + í†µí™” ë‹¤ì´ì–¼ë¡œê·¸ |
| `lib/screens/pharmacy_screen.dart` | í˜„ì¬ ìœ„ì¹˜ + ìµœê·¼ ì•½êµ­ ê²€ìƒ‰, KakaoMap ê²½ë¡œ |
| `lib/screens/hospital_navigation_screen.dart` | ê±´ì–‘ëŒ€í•™êµë³‘ì› ê¸¸ì°¾ê¸°, ì¶œë°œì§€ ìë™ ì„¤ì • |


---

## 4. ë°±ì—”ë“œ(Django) êµ¬ì„±

| íŒŒì¼ | ë‚´ìš© |
| --- | --- |
| `patients/models.py` | Patient, Appointment, MedicalRecord, PatientUser |
| `patients/serializers.py` | ëª¨ë¸ ì§ë ¬í™”. `AppointmentSerializer`ê°€ `patient_id` í•„ë“œ ì“°ê¸° í—ˆìš© |
| `patients/views.py` | ViewSet / APIView. `my_appointments`ëŠ” `patient_identifier`ë¡œ í•„í„° |
| `patients/mobile_views.py` | ìµœì‹  APK ì •ë³´ ì œê³µ, ë‹¤ìš´ë¡œë“œ ê¸°ë¡ |
| `patients/urls.py` | `/api/patients/...` ì—”ë“œí¬ì¸íŠ¸ ë§¤í•‘ |
| `eventeye/settings.py` | `FLUTTER_GITHUB_REPO` ë“± ëª¨ë°”ì¼ ë°°í¬ ì„¤ì • |

**ì£¼ìš” API íë¦„**
- `/api/patients/login/` â†’ ì„¸ì…˜ í† í° + patient_id ì‘ë‹µ
- `/api/patients/appointments/` (POST) â†’ ì˜ˆì•½ ìƒì„±
- `/api/patients/appointments/my_appointments/` â†’ patient_idë³„ ì˜ˆì•½ ëª©ë¡
- `/api/patients/mobile/latest-apk/` â†’ GitHub Releases ìµœì‹  ë²„ì „ ì •ë³´

---

## 5. Kakao Map & ë„¤ë¹„ê²Œì´ì…˜ êµ¬í˜„

### ê³µí†µ
- `geolocator`ë¡œ GPS ê¶Œí•œ/ìœ„ì¹˜ ìš”ì²­ â†’ ì˜ˆì™¸ ì²˜ë¦¬(ê¶Œí•œ ê±°ë¶€/ì„œë¹„ìŠ¤ ë¯¸í™œì„±í™”)
- `kakao_map_plugin`ìœ¼ë¡œ ì§€ë„ ìœ„ì ¯ ë Œë”ë§, `Marker` ë°°ì—´ ì§€ì •
- `url_launcher`ë¡œ KakaoMap ì•± URL (`kakaomap://route?...`) í˜¹ì€ ì›¹ í´ë°±

### ì•½êµ­ ì•ˆë‚´ (`pharmacy_screen.dart`)
1. `_determinePosition()` â†’ í˜„ì¬ ìœ„ì¹˜
2. `KakaoLocalService.fetchNearbyPharmacies()` â†’ Kakao ì¥ì†Œ ê²€ìƒ‰ API (REST í˜¸ì¶œ)
3. ìµœê·¼ ì•½êµ­ ì„ íƒ, ë‘ ë§ˆì»¤ ë°°ì¹˜
   - í˜„ì¬ ìœ„ì¹˜: ê¸°ë³¸ ë§ˆì»¤ + `infoWindowContent 'ğŸ“ í˜„ì¬ ìœ„ì¹˜'`
   - ì•½êµ­: ë¹¨ê°„ ë§ˆì»¤ + `infoWindowContent 'ğŸ’Š ì•½êµ­ëª…'`
4. ê²½ë¡œ ì•ˆë‚´ ë²„íŠ¼ â†’  
   ```
   kakaomap://route?
     sp=<lat,lng>&sn=ë‚´+ìœ„ì¹˜&
     ep=<ì•½êµ­ìœ„ë„,ì•½êµ­ê²½ë„>&en=ì•½êµ­ëª…&
     by=CAR
   ```
5. KakaoMap ì•±ì´ ì—†ìœ¼ë©´ `https://map.kakao.com/link/to/...` ì›¹ URLë¡œ ë¸Œë¼ìš°ì € ì—´ê¸°

### ë³‘ì› ê¸¸ì°¾ê¸° (`hospital_navigation_screen.dart`)
1. ì•± ì‹œì‘ ì‹œ `_getUserLocation()`ìœ¼ë¡œ ì‚¬ìš©ì ì¢Œí‘œ ì €ì¥
2. ëª©ì ì§€ëŠ” `MapConfig.hospitalName = 'ê±´ì–‘ëŒ€í•™êµë³‘ì›'` / ê³ ì • ì¢Œí‘œ
3. ê²½ë¡œ URLì— ì¶œë°œì§€(`sp/sn`)ëŠ” í˜„ì¬ ìœ„ì¹˜, ë„ì°©ì§€(`ep/en`)ëŠ” ë³‘ì›ìœ¼ë¡œ ì„¤ì •
4. KakaoMap ì•±ì—ì„œ ìë™ìœ¼ë¡œ ì¶œë°œì§€/ëª©ì ì§€ê°€ ì…ë ¥ë˜ì–´ ì¦‰ì‹œ ì•ˆë‚´ ì‹œì‘ ê°€ëŠ¥

---

## 6. CI/CD & ë°°í¬

### GitHub Actions (`.github/workflows/build-all.yml`)
1. íŠ¸ë¦¬ê±°: `main` ë¸Œëœì¹˜ push, ë˜ëŠ” ìˆ˜ë™ `workflow_dispatch`
2. ê³µí†µ ë‹¨ê³„
   - `actions/checkout`
   - `subosito/flutter-action` â†’ Flutter 3.27.1
   - `flutter pub get`
   - `flutter analyze --no-fatal-infos --no-fatal-warnings`
3. Android Job
   - `flutter build apk --release`
   - ì‚°ì¶œ: `app-release.apk`
4. iOS Job
   - `flutter build ipa --release`
   - ì‚°ì¶œ: `app-release.ipa`
5. Release Job
   - `actions/download-artifact`
   - `softprops/action-gh-release`ë¡œ GitHub Release ìƒì„±
   - ë¦´ë¦¬ìŠ¤ ë…¸íŠ¸ì— ë²„ì „, ë¹Œë“œ ë²ˆí˜¸, ë³€ê²½ì‚¬í•­ ìë™ ê¸°ì…

### ë°°í¬ íë¦„
```
ê°œë°œ â”€git pushâ”€> GitHub Actions â”€buildâ”€> GitHub Releases
                                  â””â”€ React ì›¹ì—ì„œ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì œê³µ
                                  â””â”€ Django API latest-apk ì‘ë‹µìœ¼ë¡œ ì•± ìµœì‹  ë²„ì „ í‘œì‹œ
```

---

## 7. AltStoreë¥¼ í†µí•œ iOS ì„¤ì¹˜/ì—…ë°ì´íŠ¸

1. **ì¤€ë¹„**
   - iPhone: Developer Mode ON
   - Mac/PC: AltServer + iTunes/iCloud ìµœì‹  ë²„ì „
2. **ì„¤ì¹˜**
   - AltServerì—ì„œ `Install AltStore` â†’ ê¸°ê¸° ì„ íƒ
   - AltStore ì•± ì‹¤í–‰ â†’ `My Apps` â†’ `+` â†’ GitHub Releasesì—ì„œ ë°›ì€ IPA ì„ íƒ
3. **ì—…ë°ì´íŠ¸**
   - ê¸°ì¡´ ì•± ì‚­ì œí•˜ì§€ ë§ê³ , AltStoreì—ì„œ ìƒˆ IPA ì„ íƒ â†’ ë™ì¼ Bundle IDì— ë®ì–´ì“°ê¸°
4. **ì¬ì„œëª…**
   - 7ì¼ë§ˆë‹¤ AltStore `Refresh All`ë¡œ ì¸ì¦ ê°±ì‹ 

ìì„¸í•œ ë‹¨ê³„ëŠ” `IOS_INSTALL_GUIDE.md` ì°¸ì¡°.

---

## 8. ë²„ì „Â·ë¦´ë¦¬ìŠ¤ ê´€ë¦¬

- `pubspec.yaml`ì˜ `version: X.Y.Z+build` ë¡œ ê´€ë¦¬.  
  ì˜ˆ) `1.0.10+18` (ì•± ë²„ì „ 1.0.10, ë¹Œë“œ ë„˜ë²„ 18)
- GitHub Release ì œëª© ì˜ˆ: `v1.0.10 (Build 18)`
- ê° ë¦´ë¦¬ìŠ¤ì—ëŠ”
  - APK/IPA íŒŒì¼
  - ë³€ê²½ ìš”ì•½
  - ë¹Œë“œ ì‹œê°„/ì»¤ë°‹ í•´ì‹œ
- ë²„ì „ ì—… ì‹œ CIë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ ìë™ìœ¼ë¡œ ë¦´ë¦¬ìŠ¤ ì—…ë°ì´íŠ¸

---

## 9. ë¬¸ì œ í•´ê²° ì‚¬ë¡€ (íŒ€ ê³µìœ ìš©)

| ì´ìŠˆ | ì›ì¸ | í•´ê²° |
| --- | --- | --- |
| ì˜ˆì•½ API 400 | Flutterê°€ `patient_identifier`ë¥¼ ë³´ëƒˆì§€ë§Œ DjangoëŠ” `patient_id` í•„ë“œë¥¼ ê¸°ëŒ€ | `Appointment.toCreateJson()` ìˆ˜ì •, ViewSet í•„í„°ë„ `patient_identifier` ì‚¬ìš© |
| Flutter analyze CI ì‹¤íŒ¨ | Dart SDK ë²„ì „ ë¯¸ìŠ¤ë§¤ì¹˜, ê²½ê³ ë¡œ ì‹¤íŒ¨ | `sdk >=3.0.0 <4.0.0`, `--no-fatal-infos/warnings` |
| Kakao ê²½ë¡œ ëª©ì ì§€ ë¯¸í‘œì‹œ | Kakao URL íŒŒë¼ë¯¸í„° ëˆ„ë½ | `sp/sn/ep/en/by` ëª¨ë‘ í¬í•¨ |
| ì•½êµ­ í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ê¹¨ì§ | ì™¸ë¶€ ë§ˆì»¤ ì´ë¯¸ì§€ ë¡œë”© ì‹¤íŒ¨ | ê¸°ë³¸ ë§ˆì»¤ ì‚¬ìš© + ì´ëª¨ì§€ë¡œ êµ¬ë¶„ |
| AltStore ì—ëŸ¬ 2003 | AltServer ì‹¤í–‰/ì¸ì¦ ë¬¸ì œ | AltServer ì¬ì‹¤í–‰, iTunes/iCloud ì—…ë°ì´íŠ¸, USB ì¼€ì´ë¸”/í¬íŠ¸ í™•ì¸ |

---

## 10. ë°œí‘œ/êµìœ¡ ì‹œ ì¶”ì²œ íë¦„
1. **ë¬¸ì œ ì •ì˜**: í™˜ì ê²½í—˜ ê°œì„ , ì˜ˆì•½/ì•Œë¦¼/ê³ ê°ì„¼í„° í•„ìš”ì„±
2. **ë°ëª¨**: ë¡œê·¸ì¸ â†’ ì˜ˆì•½ â†’ ê³ ê°ì„¼í„° â†’ ì§€ë„ ê¸¸ì°¾ê¸°
3. **ì•„í‚¤í…ì²˜ ì„¤ëª…**: ì „ì²´ ë‹¤ì´ì–´ê·¸ë¨ + ë°ì´í„° íë¦„
4. **ì„¸ë¶€ ê¸°ëŠ¥**: ì§€ë„/Kakao API, ì˜ˆì•½ API, CI/CD
5. **ë°°í¬ ë°©ì‹**: GitHub Releases, AltStore, React ë‹¤ìš´ë¡œë“œ í˜ì´ì§€
6. **í–¥í›„ ê³„íš**: í‘¸ì‹œ ì•Œë¦¼, ì±—ë´‡, APK ìë™ ì—…ë°ì´íŠ¸ ì•Œë¦¼ ë“±

---

ì´ ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¡°ì›ë“¤ì—ê²Œ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•˜ë©´, ê¸°ìˆ  êµ¬ì¡°ì™€ ìš´ì˜ ë°©ì‹ ì „ì²´ë¥¼ ì‰½ê²Œ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•„ìš” ì‹œ ìŠ¬ë¼ì´ë“œë¡œë„ ë³€í™˜í•˜ì„¸ìš”! ğŸ§‘â€ğŸ«âœ¨

